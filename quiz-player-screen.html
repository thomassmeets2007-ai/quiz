<!DOCTYPE html>
<!-- saved from url=(0197)https://storagegenaiplatformprod.blob.core.windows.net/public/quiz-player-fixed_f6c95.html?se=2026-06-16T11%3A18%3A00Z&sp=r&sv=2025-07-05&sr=b&sig=yOHQwAH6XQdplObyQOkNOH6y0FAMSwEsf%2BwCCgcwY%2BQ%3D -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ Deloitte Actuarial Quiz - Player</title>
    <link href="./quiz-player-screen_files/css2" rel="stylesheet">
    <link href="./quiz-player-screen_files/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #0B3D2C 0%, #1a5f3f 50%, #2d8659 100%); 
            color: white; 
            min-height: 100vh; 
            overflow-x: hidden; 
        }
        
        /* Christmas snowflake animation */
        .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .snowflake { position: absolute; color: white; font-size: 2rem; opacity: 0.8; animation: snowfall 10s linear infinite; }
        @keyframes snowfall { 0% { top: -10%; opacity: 1; } 100% { top: 100%; opacity: 0.3; } }
        
        .snowflake:nth-child(1) { left: 10%; animation-duration: 12s; animation-delay: 0s; }
        .snowflake:nth-child(2) { left: 20%; animation-duration: 14s; animation-delay: 2s; }
        .snowflake:nth-child(3) { left: 30%; animation-duration: 11s; animation-delay: 4s; }
        .snowflake:nth-child(4) { left: 40%; animation-duration: 13s; animation-delay: 1s; }
        .snowflake:nth-child(5) { left: 50%; animation-duration: 15s; animation-delay: 3s; }
        .snowflake:nth-child(6) { left: 60%; animation-duration: 12s; animation-delay: 5s; }
        .snowflake:nth-child(7) { left: 70%; animation-duration: 14s; animation-delay: 2s; }
        .snowflake:nth-child(8) { left: 80%; animation-duration: 11s; animation-delay: 4s; }
        .snowflake:nth-child(9) { left: 90%; animation-duration: 13s; animation-delay: 1s; }
        
        .container { max-width: 1000px; margin: 0 auto; padding: 30px; }
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .welcome-card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(20px); 
            border-radius: 24px; 
            padding: 60px; 
            text-align: center; 
            border: 3px solid rgba(220, 20, 60, 0.5); 
            max-width: 800px; 
            margin: 50px auto; 
            box-shadow: 0 8px 32px rgba(220, 20, 60, 0.3);
        }
        
        .welcome-title { 
            font-size: 2.5rem; 
            font-weight: 800; 
            background: linear-gradient(135deg, #DC143C, #FFD700); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 20px; 
        }
        
        .input-group { margin: 30px 0; }
        .input-group input { 
            width: 100%; 
            padding: 15px; 
            font-size: 1.1rem; 
            border: 2px solid rgba(220, 20, 60, 0.3); 
            border-radius: 12px; 
            background: rgba(255, 255, 255, 0.1); 
            color: white; 
            text-align: center;
        }
        .input-group input::placeholder { color: rgba(255, 255, 255, 0.6); }
        
        .btn { 
            background: linear-gradient(135deg, #DC143C, #FF6347); 
            border: none; 
            border-radius: 12px; 
            padding: 18px 40px; 
            font-size: 1.2rem; 
            font-weight: 700; 
            color: white; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-family: 'Inter', sans-serif; 
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.4); 
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(220, 20, 60, 0.6); }
        
        .question-header { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border-radius: 20px; 
            padding: 30px; 
            margin-bottom: 30px; 
            border: 2px solid rgba(220, 20, 60, 0.3); 
        }
        .question-number { color: #FFD700; font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; }
        .question-text { font-size: 2rem; font-weight: 700; margin-bottom: 20px; }
        
        .timer-bar { width: 100%; height: 20px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .timer-fill { height: 100%; background: linear-gradient(90deg, #FFD700, #DC143C); transition: width 0.1s linear; border-radius: 10px; }
        .timer-text { text-align: center; font-size: 1.5rem; font-weight: 700; margin-top: 10px; }
        
        .answers-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 30px; }
        .answer-btn { 
            background: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(10px); 
            border: 3px solid transparent; 
            border-radius: 16px; 
            padding: 20px; 
            font-size: 1.2rem; 
            font-weight: 600; 
            color: white; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            text-align: left;
        }
        .answer-btn:hover { transform: translateX(10px); }
        .answer-btn.selected { border-color: #FFD700; background: rgba(255, 215, 0, 0.2); }
        .answer-btn.disabled { cursor: not-allowed; opacity: 0.6; }
        
        .answer-btn:nth-child(1) { background: linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(178, 34, 34, 0.3)); border-color: rgba(220, 20, 60, 0.5); }
        .answer-btn:nth-child(2) { background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(218, 165, 32, 0.3)); border-color: rgba(255, 215, 0, 0.5); }
        .answer-btn:nth-child(3) { background: linear-gradient(135deg, rgba(34, 139, 34, 0.3), rgba(50, 205, 50, 0.3)); border-color: rgba(34, 139, 34, 0.5); }
        .answer-btn:nth-child(4) { background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(192, 192, 192, 0.3)); border-color: rgba(255, 255, 255, 0.5); }
        
        .answer-btn.correct { background: linear-gradient(135deg, rgba(34, 197, 94, 0.8), rgba(22, 163, 74, 0.8)) !important; border-color: #22C55E !important; }
        .answer-btn.incorrect { background: linear-gradient(135deg, rgba(220, 20, 60, 0.8), rgba(178, 34, 34, 0.8)) !important; border-color: #DC143C !important; }
        
        .position-display { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border-radius: 20px; 
            padding: 40px; 
            border: 2px solid rgba(220, 20, 60, 0.3); 
            text-align: center; 
            margin: 30px 0; 
        }
        .position-display h2 { font-size: 3rem; font-weight: 800; margin-bottom: 30px; }
        .position-display h2.correct { color: #22C55E; }
        .position-display h2.wrong { color: #FF6347; }
        .position-text { font-size: 3rem; font-weight: 800; color: #DC143C; margin-bottom: 20px; }
        .score-text { font-size: 1.5rem; color: #FFD700; }
        
        .feedback-section { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border-radius: 20px; 
            padding: 30px; 
            border: 2px solid rgba(220, 20, 60, 0.3); 
            text-align: center; 
            margin: 20px 0; 
        }
        
        .feedback-correct { 
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.3)); 
            border-color: #22C55E !important; 
        }
        .feedback-correct h3 { color: #22C55E; font-size: 1.8rem; margin-bottom: 10px; }
        
        .feedback-incorrect { 
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(178, 34, 34, 0.3)); 
            border-color: #DC143C !important; 
        }
        .feedback-incorrect h3 { color: #FF6347; font-size: 1.8rem; margin-bottom: 10px; }
        
        .points-display { font-size: 2rem; font-weight: 800; color: #FFD700; margin-top: 15px; }
        
        .waiting-message { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border-radius: 20px; 
            padding: 40px; 
            border: 2px solid rgba(220, 20, 60, 0.3); 
            text-align: center; 
            font-size: 1.5rem; 
            margin: 30px 0;
        }
        
        .error-message { background: rgba(220, 20, 60, 0.2); border: 2px solid #DC143C; border-radius: 12px; padding: 20px; margin: 20px 0; color: #FFD700; }
        
        @media (max-width: 768px) { 
            .question-text { font-size: 1.5rem; } 
            .welcome-title { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
        <div class="snowflake">‚ùÑÔ∏è</div>
    </div>

    <div class="container">
        <div id="welcome-screen" class="screen active">
            <div class="welcome-card">
                <h1 class="welcome-title">üéÑ Join the Quiz üéÑ</h1>
                <div class="input-group">
                    <input type="text" id="player-name" placeholder="Enter your name" onkeypress="if(event.key===&#39;Enter&#39;) joinQuiz()">
                </div>
                <button class="btn" onclick="joinQuiz()">
                    <i class="fas fa-sign-in-alt"></i> Join Quiz
                </button>
                <div id="error-display"></div>
            </div>
        </div>

        <div id="waiting-screen" class="screen">
            <div class="waiting-message">
                <h2>‚è≥ Waiting for Quiz to Start...</h2>
                <p style="margin-top: 20px; opacity: 0.8;">The host will start the quiz soon</p>
            </div>
        </div>

        <div id="question-screen" class="screen">
            <div class="question-header">
                <div class="question-number">Question <span id="q-number">1</span> of 3</div>
                <div class="question-text" id="question-text"></div>
                <div class="timer-bar">
                    <div class="timer-fill" id="timer-fill"></div>
                </div>
                <div class="timer-text"><span id="timer-text">15</span>s</div>
            </div>

            <div class="answers-grid" id="answers-display"></div>
        </div>

        <div id="position-screen" class="screen">
            <div class="position-display">
                <h2 id="result-title"></h2>
                <div id="feedback-display"></div>
                <div class="position-text">Position: <span id="player-position">-</span></div>
                <p style="margin-top: 30px; opacity: 0.8;">Waiting for host to continue...</p>
            </div>
        </div>
    </div>

    <script type="module">
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDz-6CA1h6GGA50sAOCQ0-3sA-hCWut9WU",
            databaseURL: "https://quiz-townhall-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "quiz-townhall"
        };

        let db = null;
        let playerId = null;
        let playerName = null;
        let quizId = null;
        let currentQuestion = -1;
        let timerInterval = null;
        let questionStartTime = 0;
        let selectedAnswer = null;
        let quizStarted = false;
        let playerAnswerTime = null;
        let lastSeenQuestion = -1;

        const quizData = [
            { 
                question: "How many FTE did our Deloitte actuarial team have at the end of FY25?", 
                answers: ["2015", "2076", "2085", "1965"], 
                correct: 2 
            },
            { 
                question: "What was Deloitte France's revenue in FY25?", 
                answers: ["21.1 M", "20.2 M", "19.8 M", "20.4 M"], 
                correct: 1 
            },
            { 
                question: "An insurance company is assessing the risk of a Christmas party with 500 guests. Historical data shows: Probability of injury: 1% per guest, Average claim cost: $1,000 per injury. What is the expected loss?", 
                answers: ["$5,000", "$500", "$50,000", "$10,000"], 
                correct: 0 
            }
        ];

        window.joinQuiz = async function() {
            playerName = document.getElementById('player-name').value.trim();
            
            if (!playerName) {
                showError('Please enter your name');
                return;
            }

            if (FIREBASE_CONFIG.apiKey === "YOUR_API_KEY_HERE") {
                showError('‚ùå Firebase credentials not configured.');
                return;
            }

            try {
                const firebaseApp = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const firebaseDatabase = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

                const app = firebaseApp.initializeApp(FIREBASE_CONFIG);
                db = firebaseDatabase.getDatabase(app);

                // Get quiz ID from URL
                const params = new URLSearchParams(window.location.search);
                quizId = params.get('quiz');

                if (!quizId) {
                    showError('No quiz ID provided');
                    return;
                }

                // Create player entry
                playerId = 'player-' + Math.random().toString(36).substr(2, 9);
                const { set, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                
                await set(ref(db, `quizzes/${quizId}/players/${playerId}`), {
                    name: playerName,
                    score: 0,
                    answers: [],
                    answerTimes: [],
                    joinedAt: Date.now()
                });

                // Check if quiz has already started
                const quizSnapshot = await get(ref(db, `quizzes/${quizId}/status`));
                const quizStatus = quizSnapshot.val();
                
                if (quizStatus === 'active') {
                    // Quiz already started, listen for question changes
                    listenToQuestionChanges();
                } else {
                    // Quiz not started yet, show waiting screen
                    showScreen('waiting-screen');
                    listenToQuizStart();
                }

            } catch (error) {
                showError('Connection failed: ' + error.message);
            }
        };

        function showError(message) {
            document.getElementById('error-display').innerHTML = `
                <div class="error-message">
                    <strong><i class="fas fa-exclamation-circle"></i> Error:</strong> ${message}
                </div>
            `;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        async function listenToQuizStart() {
            const { onValue, ref } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
            
            onValue(ref(db, `quizzes/${quizId}/status`), (snapshot) => {
                const status = snapshot.val();
                if (status === 'active' && !quizStarted) {
                    quizStarted = true;
                    listenToQuestionChanges();
                }
            });
        }

        async function listenToQuestionChanges() {
            const { onValue, ref } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
            
            onValue(ref(db, `quizzes/${quizId}/currentQuestion`), (snapshot) => {
                const question = snapshot.val();
                // FIX: Use lastSeenQuestion to track if this is a new question
                if (question !== null && question !== undefined && question !== lastSeenQuestion) {
                    lastSeenQuestion = question;
                    currentQuestion = question;
                    showScreen('question-screen');
                    loadQuestion();
                }
            });
        }

        async function loadQuestion() {
            const question = quizData[currentQuestion];
            document.getElementById('q-number').textContent = currentQuestion + 1;
            document.getElementById('question-text').textContent = question.question;

            const answersDisplay = document.getElementById('answers-display');
            const letters = ['A', 'B', 'C', 'D'];
            answersDisplay.innerHTML = question.answers.map((answer, index) => `
                <button class="answer-btn" onclick="selectAnswer(${index})">
                    <strong>${letters[index]}:</strong> ${answer}
                </button>
            `).join('');

            selectedAnswer = null;
            playerAnswerTime = null;
            questionStartTime = Date.now();
            startTimer();
        }

        function startTimer() {
            let timeLeft = 15;
            document.getElementById('timer-text').textContent = timeLeft;
            document.getElementById('timer-fill').style.width = '100%';

            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                const percentage = (timeLeft / 15) * 100;
                document.getElementById('timer-fill').style.width = percentage + '%';
                document.getElementById('timer-text').textContent = Math.ceil(timeLeft);

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitAnswer();
                }
            }, 100);
        }

        window.selectAnswer = async function(answerIndex) {
            clearInterval(timerInterval);
            selectedAnswer = answerIndex;
            playerAnswerTime = Date.now();

            // Highlight selected answer
            document.querySelectorAll('.answer-btn').forEach((btn, idx) => {
                if (idx === answerIndex) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
                btn.classList.add('disabled');
                btn.style.pointerEvents = 'none';
            });

            // Submit after a short delay
            await new Promise(resolve => setTimeout(resolve, 500));
            submitAnswer();
        };

        async function submitAnswer() {
            const { update, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

            if (selectedAnswer !== null && playerAnswerTime !== null) {
                const answers = [];
                const answerTimes = [];
                
                answers[currentQuestion] = selectedAnswer;
                answerTimes[currentQuestion] = playerAnswerTime;

                await update(ref(db, `quizzes/${quizId}/players/${playerId}`), {
                    answers: answers,
                    answerTimes: answerTimes
                });
            }

            // Wait for host to click next question
            listenToNextQuestion();
        }

        async function listenToNextQuestion() {
            const { onValue, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
            
            // Show position screen with feedback
            showScreen('position-screen');
            
            // Get current player data and show feedback
            const snapshot = await get(ref(db, `quizzes/${quizId}/players/${playerId}`));
            const playerData = snapshot.val();
            const question = quizData[currentQuestion];
            
            // Determine if answer was correct
            const playerAnswer = playerData.answers ? playerData.answers[currentQuestion] : null;
            const isCorrect = playerAnswer === question.correct;
            
            // Calculate points
            let points = 0;
            if (isCorrect && playerData.answerTimes && playerData.answerTimes[currentQuestion]) {
                const answerTime = playerData.answerTimes[currentQuestion];
                const timeElapsed = answerTime - questionStartTime;
                points = Math.max(0, Math.round(1000 - (timeElapsed / 15000) * 1000));
            }
            
            // Display feedback and update title
            const feedbackDisplay = document.getElementById('feedback-display');
            const resultTitle = document.getElementById('result-title');
            
            if (isCorrect) {
                resultTitle.textContent = '‚úÖ Correct';
                resultTitle.className = 'correct';
                feedbackDisplay.innerHTML = `
                    <div class="feedback-section feedback-correct">
                        <h3>Great job!</h3>
                        <div class="points-display">+${points} points</div>
                    </div>
                `;
            } else {
                resultTitle.textContent = '‚ùå Wrong';
                resultTitle.className = 'wrong';
                feedbackDisplay.innerHTML = `
                    <div class="feedback-section feedback-incorrect">
                        <h3>Better luck next time!</h3>
                        <p style="margin-top: 10px;">The correct answer was: <strong>${question.answers[question.correct]}</strong></p>
                        <div class="points-display">+0 points</div>
                    </div>
                `;
            }
            
            // Get current player position and score
            const allPlayersSnapshot = await get(ref(db, `quizzes/${quizId}/players`));
            const players = allPlayersSnapshot.val() || {};
            
            const leaderboard = Object.entries(players)
                .map(([id, player]) => ({ id, name: player.name, score: player.score || 0 }))
                .sort((a, b) => b.score - a.score);
            
            const playerPosition = leaderboard.findIndex(p => p.id === playerId) + 1;
            const playerScore = players[playerId].score || 0;
            
            document.getElementById('player-position').textContent = playerPosition;
            document.getElementById('player-score').textContent = playerScore;
            
            // Listen for next question (host clicks next)
            // FIX: Use lastSeenQuestion to detect when a new question is loaded
            onValue(ref(db, `quizzes/${quizId}/currentQuestion`), (snapshot) => {
                const nextQuestion = snapshot.val();
                if (nextQuestion !== null && nextQuestion !== lastSeenQuestion) {
                    lastSeenQuestion = nextQuestion;
                    currentQuestion = nextQuestion;
                    showScreen('question-screen');
                    loadQuestion();
                }
            });
        }
    </script>

<div id="give-freely-root-ejkiikneibegknkgimmihdpcbcedgmpo" class="give-freely-root" data-extension-id="ejkiikneibegknkgimmihdpcbcedgmpo" data-extension-name="Volume Booster" style="display: block;"><template shadowrootmode="open"><style>
  :host {
    all: initial;
  }

  .gf-scroll-remove::-webkit-scrollbar {
    border-radius-bottom-right: 15px;
  }

  button {
    cursor: pointer;
    transition: transform 0.1s ease;
  }

  button:active {
    transform: scale(0.98);
  }

  .give-freely-close-button:hover {
    opacity: 0.7;
  }

  input[type="radio"] {
    margin-right: 8px;
  }

  hr {
    border: none;
    border-top: 1px solid #e5e5e5;
    margin: 1em 0;
  }

  @media (max-width: 600px), (max-height: 480px) {
    #give-freely-checkout-popup {
      display: none !important;
    }
  }
</style><div><div class="gf-app"></div></div></template></div></body></html>